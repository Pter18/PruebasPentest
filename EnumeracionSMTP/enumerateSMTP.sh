#!/usr/bin/env bash
: <<'END_COMENT'
Plan de Becarios Seguridad Informatica Generacion 13
Alumno: Rodriguez Gallardo Pedro Alejandro
Curso: Pruebas de penetracion

Programa que enumera los usuarios en un servidor SMTP a traves de los comandos VRFY y RCPT,
usando una lista de usuarios y la IP del servidor SMTP, las peticiones se hacen por medio de netcat.

Modo de uso: ./enumerateSMTP.sh <lista> <IP>
             ./enumerateSMTP.sh unix_users.txt 192.168.0.29

END_COMENT

if [[ $# -eq 2 ]]; then
  echo "      ------ Enumeracion por VRFY ------"
  for user in $(cat $1);
    do
      echo "vrfy $user" | nc -q 2 $2 25 | grep '^252' | cut -f3 -d" "
    done

  echo "      ------ Enumeracion por RCPT ------"
  for user in $(cat $1);
    do
      ( echo MAIL FROM: root
      	echo RCPT TO: $user
      	echo .
      	echo QUIT ) | nc -q 2 $2 25 | grep -q '^250 2.1.5 Ok'
        if [[ $? == 0 ]]; then
          echo $user
        fi
    done
else
  echo "Modo de uso: ./enumerateSMTP.sh <lista> <IP>
             ./enumerateSMTP.sh unix_users.txt 192.168.0.29"
fi
